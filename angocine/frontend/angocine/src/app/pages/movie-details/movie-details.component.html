<div class="movie-details-page">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Carregando detalhes do filme...</p>
  </div>
  
  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <div class="alert alert-danger" role="alert">
      <i class="fas fa-exclamation-circle me-2"></i>
      {{ error }}
    </div>
    <button class="btn btn-primary mt-3" routerLink="/browse">Voltar para o Catálogo</button>
  </div>
  
  <!-- Movie Content -->
  <ng-container *ngIf="!isLoading && !error && movie">
    <!-- Hero Section -->
    <div class="movie-hero" [ngStyle]="{'background-image': 'url(' + getBackdropUrl() + ')'}">
      <div class="container">
        <div class="row">
          <div class="col-md-4 col-lg-3">
            <div class="movie-poster">
              <img [src]="getPosterUrl()" [alt]="movie.title" class="poster-image">
            </div>
          </div>
          <div class="col-md-8 col-lg-9">
            <div class="movie-info">
              <h1 class="movie-title">{{ movie.title }}</h1>
              
              <div class="movie-meta">
                <span class="movie-year" *ngIf="movie.release_year">{{ movie.release_year }}</span>
                <span class="movie-duration" *ngIf="movie.duration">{{ formatDuration() }}</span>
                <span class="movie-rating" *ngIf="movie.rating">
                  <i class="fas fa-star"></i> {{ movie.rating }}
                </span>
                <span class="movie-maturity" *ngIf="movie.maturity_rating">
                  {{ movie.maturity_rating }}
                </span>
              </div>
              
              <div class="movie-genres">
                <span class="movie-genre" *ngFor="let genre of getGenres()">{{ genre }}</span>
              </div>
              
              <p class="movie-description">{{ movie.description }}</p>
              
              <div class="movie-details">
                <div class="detail-item" *ngIf="movie.director">
                  <span class="detail-label">Diretor:</span>
                  <span class="detail-value">{{ movie.director }}</span>
                </div>
                <div class="detail-item" *ngIf="movie.cast">
                  <span class="detail-label">Elenco:</span>
                  <span class="detail-value">{{ movie.cast }}</span>
                </div>
                <div class="detail-item" *ngIf="movie.language">
                  <span class="detail-label">Idioma:</span>
                  <span class="detail-value">{{ movie.language }}</span>
                </div>
              </div>
              
              <div class="movie-actions">
                <button class="btn btn-primary btn-lg" (click)="watchMovie()">
                  <i class="fas fa-play me-2"></i> Assistir
                </button>
                <button class="btn btn-outline-light btn-lg ms-3" (click)="openTrailer()" *ngIf="trailerUrl">
                  <i class="fas fa-film me-2"></i> Trailer
                </button>
                <app-watchlist-button 
                  [movieId]="movie.id" 
                  size="lg" 
                  variant="outline" 
                  class="ms-3">
                </app-watchlist-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Content Sections -->
    <div class="container movie-content">
      <div class="row">
        <div class="col-lg-8">
          <!-- Reviews Section -->
          <section class="movie-section">
            <h2 class="section-title">Avaliações e Comentários</h2>
            
            <!-- Review Form -->
            <div class="review-form" *ngIf="isLoggedIn && currentProfile">
              <h3 class="form-title">Deixe sua avaliação</h3>
              
              <div class="form-group">
                <label>Sua avaliação:</label>
                <app-rating-stars 
                  [(rating)]="userRating" 
                  [maxRating]="5" 
                  size="lg">
                </app-rating-stars>
              </div>
              
              <div class="form-group">
                <label for="reviewComment">Seu comentário (opcional):</label>
                <textarea 
                  id="reviewComment" 
                  class="form-control" 
                  rows="3" 
                  [(ngModel)]="userReview" 
                  placeholder="Escreva um comentário sobre o filme...">
                </textarea>
              </div>
              
              <div class="alert alert-danger" *ngIf="reviewError">
                <i class="fas fa-exclamation-circle me-2"></i>
                {{ reviewError }}
              </div>
              
              <button 
                class="btn btn-primary" 
                (click)="submitReview()" 
                [disabled]="isSubmittingReview">
                <span *ngIf="isSubmittingReview" class="spinner-border spinner-border-sm me-2" role="status"></span>
                Enviar Avaliação
              </button>
            </div>
            
            <!-- Login to Review -->
            <div class="login-to-review" *ngIf="!isLoggedIn">
              <p>Faça login para deixar sua avaliação</p>
              <a routerLink="/auth/login" [queryParams]="{returnUrl: '/movie/' + movie.id}" class="btn btn-outline-primary">
                Entrar
              </a>
            </div>
            
            <!-- Select Profile to Review -->
            <div class="login-to-review" *ngIf="isLoggedIn && !currentProfile">
              <p>Selecione um perfil para deixar sua avaliação</p>
              <a routerLink="/profile" class="btn btn-outline-primary">
                Selecionar Perfil
              </a>
            </div>
            
            <!-- Reviews List -->
            <div class="reviews-list">
              <h3 class="reviews-title">
                {{ reviews.length }} Avaliações
                <span *ngIf="movie.ratings?.average">(Média: {{ movie.ratings.average }})</span>
              </h3>
              
              <!-- No Reviews -->
              <div class="no-reviews" *ngIf="reviews.length === 0">
                <p>Ainda não há avaliações para este filme. Seja o primeiro a avaliar!</p>
              </div>
              
              <!-- Reviews -->
              <div class="review-item" *ngFor="let review of reviews">
                <div class="review-header">
                  <div class="review-user">
                    <i class="fas fa-user-circle"></i>
                    <span class="review-username">{{ review.username }}</span>
                  </div>
                  <div class="review-rating">
                    <app-rating-stars [rating]="review.rating" [readonly]="true" size="sm"></app-rating-stars>
                  </div>
                </div>
                <div class="review-content" *ngIf="review.comment">
                  {{ review.comment }}
                </div>
                <div class="review-date">
                  {{ review.created_at | date:'dd/MM/yyyy' }}
                </div>
              </div>
            </div>
          </section>
        </div>
        
        <div class="col-lg-4">
          <!-- Similar Movies -->
          <section class="movie-section" *ngIf="similarMovies.length > 0">
            <h2 class="section-title">Filmes Similares</h2>
            <div class="similar-movies">
              <div class="similar-movie" *ngFor="let similarMovie of similarMovies">
                <app-movie-card [movie]="similarMovie" [size]="'small'"></app-movie-card>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </ng-container>
  
  <!-- Trailer Modal -->
  <app-modal *ngIf="showTrailer" [title]="movie?.title + ' - Trailer'" (closed)="closeTrailer()" size="lg">
    <div class="trailer-container">
      <iframe *ngIf="trailerUrl" [src]="trailerUrl" frameborder="0" allowfullscreen></iframe>
    </div>
  </app-modal>
</div>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>